pow_before_annex = {
	hidden_effect = {
		set_variable = { getting_annexed = 1 }
		every_enemy_country = {
			limit = {
				is_playable_country =yes 
				# OR = { NOT = { original_tag = FRA } has_global_flag = fall_of_france } 
			}
			calculate_click_effect = yes
		}
	}
}

calculate_click_effect = { #prevent spam hidden idea for one day
	clear_variable = ROOT.pow_total
	every_enemy_country = {
		limit={
			is_playable_country = yes
			# OR = { NOT = { original_tag = FRA } has_global_flag = fall_of_france } 
		}

		set_temp_variable = { casualty1 = 0 }

		while_loop_effect = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands > casualty1
				}
			}
			add_to_temp_variable = { casualty1 = 1000 }
		}
		if = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands < casualty1
				}
			}
			add_to_temp_variable  = { casualty1 = -1000 }
		}
		while_loop_effect = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands > casualty1
				}
			}
			add_to_temp_variable = { casualty1 = 100 }
		}
		if = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands < casualty1
				}
			}
			add_to_temp_variable  = { casualty1 = -100 }
		}
		while_loop_effect = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands > casualty1
				}
			}
			add_to_temp_variable = { casualty1 = 10 }
		}
		if = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands < casualty1
				}
			}
			add_to_temp_variable  = { casualty1 = -10 }
		}
		while_loop_effect = {
			limit = {
				casualties_inflicted_by = {
					opponent = PREV
					thousands > casualty1
				}
			}
			add_to_temp_variable = { casualty1 = 1 }
		}

		multiply_temp_variable = { casualty1 = 0.25 }
		if = {
			limit = {
				check_variable = { getting_annexed = 1 }
			}
			add_to_variable= { PREV.pow_other_sources = casualty1 }
		}
		else = {
			add_to_variable = { ROOT.pow_total = casualty1 }
		}
	}

	add_to_variable = { ROOT.pow_total = pow_other_sources  } 
	set_variable = { ROOT.pow_unassigned = ROOT.pow_total }
	subtract_from_variable = { ROOT.pow_unassigned = ROOT.pow_assinged_total }
}

Vichy_Spawn = {
	if = {
		limit = {
		AND = {
		461 = {has_state_flag = AFRICA_COMMONWEALTH_controls }
		461 = {is_controlled_by = VIC }
			}
		}
		461 = {
		clr_state_flag = AFRICA_COMMONWEALTH_controls
		set_state_flag = NOT_AFRICA_COMMONWEALTH_controls
		}
		every_country = {
				limit = {
					OR = {
						tag = FIN
						tag = GER
						tag = HUN
						tag = ITA
						tag = ROM
						tag = SPR
						tag = YUG
						tag = VIC
					}
				}
				AFRICA_COMMONWEALTH_AXIS_bases_level_down = yes
			}
		add_to_variable = {
				var = ITA.AFRICA_COMMONWEALTH_BASES_LEVEL
				value = 1
		}
	}
	
	if = {
		limit = {
			AND = {
				458 = {has_state_flag = AFRICA_COMMONWEALTH_controls }
				OR = {
					458 = {is_controlled_by = VIC }
					458 = {is_controlled_by = ITA }
				}
			}
		}
		458 = {
		clr_state_flag = AFRICA_COMMONWEALTH_controls
		set_state_flag = NOT_AFRICA_COMMONWEALTH_controls
		}
		every_country = {
				limit = {
					OR = {
						tag = FIN
						tag = GER
						tag = HUN
						tag = ITA
						tag = ROM
						tag = SPR
						tag = YUG
						tag = VIC
					}
				}
				AFRICA_COMMONWEALTH_AXIS_bases_level_down = yes
			}
		add_to_variable = {
				var = ITA.AFRICA_COMMONWEALTH_BASES_LEVEL
				value = 1
		}
	}
}

AFRICA_COMMONWEALTH_AXIS_bases_level_down = {
	if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_16 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_16
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_17
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_15 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_15
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_16
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_14 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_14
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_15
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_13 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_13
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_14
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_12 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_12
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_13
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_11 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_11
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_12
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_10 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_10
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_11
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_9 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_9
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_10
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_8 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_8
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_9
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_7 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_7
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_8
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_6 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_6
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_7
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_5 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_5
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_6
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_4 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_4
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_5
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_3 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_3
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_4
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_2 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_2
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_3
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_1 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_1
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_2
		}
	}
}
AFRICA_COMMONWEALTH_AXIS_bases_level_up = {
	if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_2 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_2
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_1
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_3 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_3
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_2
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_4 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_4
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_3
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_5 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_5
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_4
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_6 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_6
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_5
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_7 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_7
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_6
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_8 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_8
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_7
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_9 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_9
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_8
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_10 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_10
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_9
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_11 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_11
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_10
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_12 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_12
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_11
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_13 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_13
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_12
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_14 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_14
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_13
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_15 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_15
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_14
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_16 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_16
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_15
		}
	}
	else_if = {
		limit = { has_idea = AFRICA_COMMONWEALTH_controls_axis_idea_17 }
		swap_ideas = {
			remove_idea = AFRICA_COMMONWEALTH_controls_axis_idea_17
			add_idea = AFRICA_COMMONWEALTH_controls_axis_idea_16
		}
	}
}

update_academy_weekly ={
	every_country = {
		limit = {
			is_playable_country = yes
		}
		if = {
			limit = {
				has_idea = academy_scholarships_spirit
			}
			add_to_variable = { academy_weekly_training_speed = -0.005 }
		}
		# if = {
		# 	limit = {
		# 		has_idea = political_loyalty_spirit
		# 	}
		# 	add_to_variable = { academy_weekly_pp = 0.005 }
		# }
		# if = {
		# 	limit = { 
		# 		has_idea = relief_of_command_spirit
		# 	}
		# 	add_to_variable = { academy_experience_gain = 0.005 }	
		# }
		# if = {
		# 	limit = {
		# 		has_idea = grand_battleplan_army_spirit
		# 	}
		# 	add_to_variable = { academy_special_forces_capacity = 0.5 }
		# 	if = {
		# 		limit = {
		# 			is_major = yes
		# 		}
		# 		add_to_variable = { academy_special_forces_capacity = 0.5 }
		# 	}
		# }
	}
	set_variable = { academy_weekly_training_speed_total = modifier@training_time_army_factor }
	add_to_variable = { academy_weekly_training_speed_total = academy_weekly_training_speed }
	if = {
		limit = {
			check_variable = { academy_weekly_training_speed_total <-0.60 }
		}
		set_variable = {
			academy_weekly_training_speed_result = -0.60
		}
		subtract_from_variable = { 
			academy_weekly_training_speed_result = academy_weekly_training_speed_total
		}
	}
	else = {
		set_variable = { academy_weekly_training_speed_result = academy_weekly_training_speed }
	}
}